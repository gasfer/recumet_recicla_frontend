<p-dialog [header]="'Registro de clasificado'" [(visible)]="classifiedService.showModalSaveClassified"
    [modal]="true" [breakpoints]="{ '960px': '75vw', '576px': '95%' }" [style]="{ width: '38vw' }" [draggable]="false"
    [resizable]="false" [dismissableMask]="true" (onShow)="showModal()" (onHide)="resetModal()">
    <form [formGroup]="formClassified">
        <div class="p-fluid grid">
            <div class="field col-12">
                <div class="row mt-1">
                    <div class="col-sm-6 col-12">
                        <label class="block mb-0">Producto clasificado<span class="text-danger">*</span></label><br>
                        <p-tag [rounded]="true" icon="fa-solid fa-tag"
                            [severity]="productSelect() ? 'info' : 'warning'"
                            [value]="productSelect() ? 'COD: ' + productSelect()?.cod+' / ' + productSelect()?.name : 'COD: 0 / SELECCIONE UN PRODUCTO'">
                        </p-tag><br>
                        <small *ngIf="!productSelect()" class="p-error block">
                            {{ 'Selecciona un producto' }}
                        </small> 
                    </div>
                    <div class="col-sm-6 col-12 mt-sm-0 mt-1">
                        <label class="block mb-0">Stock a reducir [{{productSelect()?.unit?.siglas}}]:<span class="text-danger">*</span></label>
                        <p-inputNumber
                            [style]="{'height': '38px'}"
                            [size]="5"
                            locale="en-US" 
                            mode="decimal" 
                            [minFractionDigits]="2"
                            [showButtons]="true"
                            decrementButtonClass="p-button-secondary"
                            incrementButtonClass="p-button-primary"
                            placeholder="0"
                            [min]="0.1"
                            [max]="productSelect()?.total_stock"
                            formControlName="quantity_product" 
                           >
                        </p-inputNumber>  
                        <small *ngIf="validatorsService.inputValid('quantity_product',formClassified)" class="p-error block">
                            {{ 'Stock no valido' }}
                        </small> 
                    </div>
                </div>
                <div class="row mt-1">
                    <div class="col-sm-6 col-12 mt-sm-0 mt-1">
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <label class="block mb-0">Tipo pesaje<span class="text-danger">*</span></label>
                                <p-dropdown [options]="types_registry()" 
                                  placeholder="Selecciona una opción" 
                                  optionLabel="name"
                                  optionValue="code"
                                  appendTo="body"
                                  formControlName="type_registry" 
                                  [class.ng-dirty]="validatorsService.inputValid('type_registry',formClassified)"
                                ></p-dropdown>
                                <small *ngIf="validatorsService.inputValid('type_registry',formClassified)" class="p-error block">
                                    {{ validatorsService.inputValidMessage("type_registry",formClassified) }}
                                </small>   
                            </div>
                            <div class="col-sm-6 col-12">
                                <label class="block mb-0">Nro.</label>
                                <input type="text" style="text-transform: uppercase" pInputText [pKeyFilter]="validatorsService.expRegValidInput"
                                    formControlName="number_registry" placeholder="EJ. 0001" 
                                    [pKeyFilter]="validatorsService.expRegValidInput"
                                    [class.ng-dirty]="validatorsService.inputValid('number_registry',formClassified)" 
                                />
                                <small *ngIf="validatorsService.inputValid('number_registry',formClassified)" class="p-error block">
                                    {{ validatorsService.inputValidMessage("number_registry",formClassified) }}
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-12 mt-sm-0 mt-1">
                        <label class="block mb-0">Pesaje<span class="text-danger">*</span></label>
                        <p-dropdown [options]="scales()" 
                          placeholder="Selecciona una opción" 
                          optionLabel="name"
                          optionValue="id"
                          appendTo="body"
                          formControlName="id_scale" 
                          [class.ng-dirty]="validatorsService.inputValid('id_scale',formClassified)"
                        ></p-dropdown>
                        <small *ngIf="validatorsService.inputValid('id_scale',formClassified)" class="p-error block">
                            {{ validatorsService.inputValidMessage("id_scale",formClassified) }}
                        </small>
                    </div>
                </div>
                <div class="row mt-1">
                    <div class="col-12 mt-sm-0 mt-1">
                        <label class="block mb-0">Observaciones</label>
                        <textarea pInputTextarea
                            type="text"
                            style="text-transform: uppercase"
                            pInputText
                            [pKeyFilter]="validatorsService.expRegValidInput"
                            formControlName="comments"
                            placeholder="EJ. ......"
                            class="mt-1"
                            [class.ng-dirty]="validatorsService.inputValid('comments',formClassified)"
                        ></textarea> 
                        <small *ngIf="validatorsService.inputValid('comments',formClassified)" class="p-error block">
                            {{ validatorsService.inputValidMessage("comments",formClassified) }}
                        </small>
                    </div>    
                </div>
            </div> 
        </div> 
      </form>
      <ng-template pTemplate="footer">
        <p-button (click)="loading() ? null : saveClassified()" styleClass="p-button-sm p-button-rounded"
            label="Guardar" icon="fa-solid fa-floppy-disk" [loading]="loading()" ></p-button>
        <p-button (click)="classifiedService.showModalSaveClassified = false" label="Cancelar" styleClass="p-button-outlined p-button-sm p-button-rounded"></p-button>
    </ng-template>
</p-dialog>